{"files":[{"id":"20c5ff81-45c4-4d0e-a78f-640ef9eef3d8","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/New_York\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"MYSELF\"\n  }\n}"},{"id":"d8c3a3de-c1f7-4952-8f9d-9c4d68cf5ca3","name":"Code","type":"server_js","source":"function saveNewAttachmentsToDrive() {\n  var folderId \u003d \"1kiA7xesDuBAbqgWqsweM7fTX7iDCxwpp\"; // Replace with the ID of the destination folder in Google Drive\n  var labelName \u003d \"SavedData\"; // Replace with the name of the Gmail label\n  var lastExecutionTime \u003d getLastExecutionDate();\n  var label \u003d GmailApp.getUserLabelByName(labelName);\n  var threads \u003d label.getThreads(); // Get all threads in the label\n  var driveFolder \u003d DriveApp.getFolderById(folderId);\n  \n  for (var i \u003d 0; i \u003c threads.length; i++) {\n    var messages \u003d threads[i].getMessages();\n    for (var j \u003d 0; j \u003c messages.length; j++) {\n      var message \u003d messages[j];\n      if (message.getDate() \u003e new Date(lastExecutionTime)) { // Check if the message is after the last execution\n        var attachments \u003d message.getAttachments();\n        for (var k \u003d 0; k \u003c attachments.length; k++) {\n          var attachment \u003d attachments[k];\n          var attachmentBlob \u003d attachment.copyBlob();\n          var fileName \u003d attachment.getName();\n          driveFolder.createFile(attachmentBlob).setName(fileName);\n        }\n      }\n    }\n    // threads[i].removeLabel(GmailApp.getUserLabelByName(\"SavedData\"));\n  }\n  updateLastExecutionDate();\n}\n\nfunction getLastExecutionDate() {\n  var properties \u003d PropertiesService.getUserProperties();\n  return properties.getProperty(\"lastExecutionDate\") || \"2023-09-01\";\n}\n\nfunction resetLastExecutionDate() {\n  PropertiesService.getUserProperties().deleteProperty(\"lastExecutionDate\");\n}\n\nfunction updateLastExecutionDate() {\n  var now \u003d new Date();\n  var dateString \u003d now.toISOString().split(\"T\")[0];\n  var properties \u003d PropertiesService.getUserProperties();\n  properties.setProperty(\"lastExecutionDate\", dateString);\n}\n"}]}